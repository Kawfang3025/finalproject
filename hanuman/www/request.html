<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
        integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Bai+Jamjuree&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title>SomDai</title>
</head>

<body
    style="background-image: radial-gradient( circle farthest-corner at 1.8% 0%,  rgba(255,255,255,1) 37.6%, #bbb 90% );">
    <nav class="navbar navbar-expand-sm justify-content-center" style="background-color: rgb(10, 6, 43)">

        <h4 class="text-light ">SomDai</h4>

    </nav>
    <div class="container" style="padding-left: 0%;height: 100%;">
        <a name="" id="" class="btn btn-dark rounded-0 top-left mt-2" href="home.html" role="button"> กลับหน้าเมนู</a>

        <div id="requestlist" class="container req">
            <hr>
        </div>

    </div>

    <script>
        var technicainID;
        var employeeID = [];
        var firstname = [];
        var lastname = [];
        var img = [];
        var detail = [];
        var date = [];
        var repairID = [];

        init();
        selectRepairingByID(technicainID);
        selectEmployeeByID(employeeID);
        showRepairList();
        function init() {
            var xmlhttp = new XMLHttpRequest();
            var email = localStorage.getItem("email");
            var url = "http://localhost:8080/technicains";
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                for (let i = 0; i < jsoutput.length; i++) {
                    if (email === jsoutput[i].e_mail) {
                        technicainID = jsoutput[i].technicainID;
                    }
                }
            }
        }

        function selectRepairingByID() {
            var xmlhttp = new XMLHttpRequest();
            var url = "http://localhost:8080/repairing/technicain/" + technicainID;
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                console.log(jsoutput.length);

                for (let i = 0; i < jsoutput.length; i++) {
                    detail.push(jsoutput[i].detail);
                    date.push(jsoutput[i].date);
                    employeeID.push(jsoutput[i].employeeID);
                    repairID.push(jsoutput[i].repairingID);
                }
            }
            console.log(detail);
            console.log(date);

        }

        function selectEmployeeByID() {
            for (let i = 0; i < employeeID.length; i++) {
                var xmlhttp = new XMLHttpRequest();
                var url = "http://localhost:8080/employees/employeeID/" + employeeID[i];
                xmlhttp.open("GET", url, false);
                xmlhttp.send();
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var output = xmlhttp.responseText;
                    var jsoutput = JSON.parse(output);
                    for (let j = 0; j < jsoutput.length; j++) {
                        firstname.push(jsoutput[j].firstName);
                        lastname.push(jsoutput[j].lastName);
                        img.push(jsoutput[j].img);
                    }
                }
            }
            console.log(employeeID);
            console.log(firstname);
            console.log(lastname);
        }


        function showRepairList() {
            for (let i = 0; i < detail.length; i++) {
                document.getElementById('requestlist').innerHTML += '<div onclick="showdetail(`' + firstname[i] + '`,`' + lastname[i] + '`,`' + detail + '`,`' + employeeID[i] + '`)"  class="row"><hr><i class="fas fa-circle ml-1 " style="color: rgb(255, 4, 4)"></i>' +
                    '<img src="img/picpro.jpg" class="col-2 rounded-circle pl-0 pr-0" width="100%">' +
                    '<div  class="col-10 row">' +
                    '<a class="col-7 text-truncate" style="font-weight:bold" >' + firstname[i] + " " + lastname[i] + '</a>' +
                    '<a class="col-5" style="font-weight:bold">' + date[i] + '</a>' +
                    '<a class="col-12 text-truncate" style="font-weight:bold;color: blue;">' + detail[i] + '</a>' +
                    '</div> </div></div><hr>';
            }
        }

        function showdetail(firstname,lastname,detail,empID) {
            
            localStorage.setItem('namerp', firstname);
            localStorage.setItem('lastrp', lastname);
            localStorage.setItem('detailrp', detail);
            localStorage.setItem('empID', empID);
            window.location.href = 'requestdetail.html';
        }
    </script>

    <script type="text/javascript" src="js/index.js"></script>

</body>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>


</html>